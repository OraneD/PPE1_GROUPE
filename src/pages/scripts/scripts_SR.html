<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title> PPE1 - Scripts</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="../../css/main.css">
    <script src="https://kit.fontawesome.com/ec3c0779e7.js" crossorigin="anonymous"></script>
</head>

<body background> 
    <section class="hero has-background-black">
        <div class="hero-body"></div>
        <div class="container has-text-centered">
        <h1 class="title is-1 has-text-primary-light">Projet Personnel Encadré</h1>
        <h2 class="subtitle is-3 has-text-primary-light">M1 - TAL</h2>
    </div>
    </div>
    <div class="block has-background-black"></div>
        <nav>
            <ul>
                <li> <a href="../../../index.html">
                    <span>Accueil</span>
                    </a>
                </li>
                <li><a href="../methode.html">
                <span>Méthode</span>
            </a>
        </li>
        <li class="deroulant"><a>Scripts</a>
            <ul class="sous">
                <li><a href="scripts_FR.html">Français</a></li>
                <li><a href="scripts_EN.html">Anglais</a></li>
                <li><a href="scripts_SR.html">Serbe</a></li>
                
            </ul>
        
        </li>
                <li class="deroulant"><a>Tableaux</a>
                <ul class="sous">
                    <li><a href="../../../URL_fr/tableau_FR.html">Français Geek</a></li>
                    <li><a href="../../../URL_fr/Tableau_nerd_FR.html">Français Nerd</a></li>
                    <li><a href="../../../URL_anglais/tableaux/tableau_Geek_anglais.html">Anglais Geek</a></li>
                    <li><a href="../../../URL_anglais/tableaux/tableau_Nerd_anglais.html">Anglais Nerd</a></li>
                    <li><a href="../../../URL_serbe/tableau_geek_rs.html">Serbe Geek</a></li>
                    <li><a href="../../../URL_serbe/tableau_nerd_rs.html">Serbe Nerd</a></li>
                    
                </ul>
            
            </li>
            <li class="deroulant"><a>Analyse</a>
                <ul class="sous">
                    <li><a href="../analyse/analyse_FR.html">Français</a></li>
                    <li><a href="../analyse/analyse_EN.html">Anglais</a></li>
                    <li><a href="../analyse/analyse_SR.html">Serbe</a></li>
                    <li><a href="../analyse/conclusion.html">Conclusion</a></li>
                    
                </ul>
            
            </li>
                <li><a href="../nuages_de_mots.html">
                    <span>Nuages de Mots</span>
                </a>
            </li>
            </ul>
        </nav>
    </div>
    
    <section class="section has-background-primary-light">
        <div class="container">
        	<div class="title"> SCRIPTS SERBE</div>
        </div>
    </section>
        <div id="mainarea">
            <div id="contentarea">
                <pre style="overflow: scroll;">
                #!/usr/bin/env bash

                #==================================================================================
                # Ce script va transformer ma liste des URL (format texte) en tableau (format HTML)
                # Le tableau contiendra :
                # -le numéro de la ligne pour chaque URL, 
                # -le code
                # -l'URL
                # -le nom de l'encodage utilisé
                # -le fichier dump en html
                # -le fichier dump en txt
                # -le nombre d'occurrences du mot choisi pour chaque URL
                # -le contexte gauche et droit du mot
                # -le concordancier avec les cooccurrences du mot
                # Pour lancer le script:
                # bash nom_du_script.sh fichier_url.txt fichier_tableau.html
                #==================================================================================
                   
                fichier_urls=$1 # le fichier d'URL en entrée
                fichier_tableau=$2 # le fichier HTML en sortie
                        
                if [[ $# -ne 2 ]]
                    then
                    echo "Ce programme demande exactement deux arguments."
                    exit
                fi
                
                # différentes formes du mot (genre/nombre/les cas + écriture emprunté )
                mot="[Gg]ik(a|u|ovi|e|ovima|ova|uša|ušu|uši|ušama|uše)?|[Gg]eek(ovi|ove|ovima|ova)?"
                        
                # ==== créer le tableau ====
                        
                echo $fichier_urls;
                basename=$(basename -s .txt $fichier_urls)
                        
                echo "<html><body>" > $fichier_tableau
                echo "<h2>Tableau $basename :</h2>" >> $fichier_tableau
                echo "<br/>" >> $fichier_tableau
                echo "<table>" >> $fichier_tableau
                echo "<tr><th>ligne</th><th>code</th><th>URL</th><th>encodage</th><th>dump html</th><th>dump text</th><th>occurrences</th><th>contextes</th><th>concordances</th></tr>" >> $fichier_tableau
                         
                # ==== remplir le tableau ==== 
                        
                lineno=1;
                while read -r URL; do
                    echo -e "\tURL : $URL";
                    # la façon attendue, sans l'option -w de cURL
                    code=$(curl -ILs $URL | grep -e "^HTTP/" | grep -Eo "[0-9]{3}" | tail -n 1)
                    charset=$(curl -Ls $URL -D - -o "./aspirations/$basename-$lineno.html" | grep -Eo "charset=(\w|-)+" | cut -d= -f2)
                        
                    # autre façon, avec l'option -w de cURL
                    # code=$(curl -Ls -o /dev/null -w "%{http_code}" $URL)
                    # charset=$(curl -ILs -o /dev/null -w "%{content_type}" $URL | grep -Eo "charset=(\w|-)+" | cut -d= -f2)
                        
                    echo -e "\tcode : $code";
                        
                    if [[ ! $charset ]]
                    then
                       echo -e "\tencodage non détecté, on prendra UTF-8 par défaut.";
                       charset="UTF-8";
                    else
                       echo -e "\tencodage : $charset";
                    fi
                        
                                if [[ $code -eq 200 ]]
                                then
                                    dump=$(lynx -dump -nolist -assume_charset=$charset -display_charset=$charset $URL)
                                    if [[ $charset -ne "UTF-8" && -n "$dump" ]]
                                    then
                                        dump=$(echo $dump | iconv -f $charset -t UTF-8//IGNORE)
                                    fi
                                else
                                    echo -e "\tcode différent de 200 utilisation d'un dump vide"
                                    dump=""
                                    charset=""
                                fi
                            echo "$dump" > "./dumps-text/$basename-$lineno.txt"
                            
                        #pour compter le nombre d'occurrences
                        NB_OCC=$(grep -E -o $mot ./dumps-text/$basename-$lineno.txt | wc -l)
                        
                            
                        #pour extraire des contextes A=after, B=before (droite et gauche)	
                        grep -P -B2 -A2 "$mot" ././dumps-text/$basename-$lineno.txt > ./contextes/$basename-$lineno.txt
                        
                        #pour construire des concordanciers avec cooccurrences depuis une commande externe
                        bash ./concordance.sh ././dumps-text/$basename-$lineno.txt "$mot" > ./concordances/$basename-$lineno.html
                        <pre>
                        # ==== ajouter dans le tableau ====
                        
                            echo "<tr><td>$lineno</td><td>$code</td><td><a href=\"$URL\">$URL</a></td><td>$charset</td><td><a href="././aspirations/$basename-$lineno.html">html</a></td><td><a href="././dumps-text/$basename-$lineno.txt">txt</a></td><td>$NB_OCC</td><td><a href="././contextes/$basename-$lineno.txt">contextes</a></td><td><a href="././concordances/$basename-$lineno.html">concordance</a></td></tr>" >> $fichier_tableau 
                            echo -e "\t--------------------------------"
                            lineno=$((lineno+1));
                        done < $fichier_urls
                        
                        # ==== fermer le tableau ==== 
                        
                        echo "</table>" >> $fichier_tableau
                        echo "</body></html>" >> $fichier_tableau
                        </div></pre>
                </pre>
            </div>
        </div>

    <footer class="footer has-background-black">
        <div class="content has-text-centered">
          <p>
             Projet réalisé par
            <a href="https://github.com/OraneD">Orane Dufour</a>
            <a href="https://github.com/LeaMondoloni/PPE1"> Léa Mondoloni</a>
            <a href="https://github.com/valentinaosetrov"> Valentina Osetrov</a>
            . Cette page internet a été créée grâce au framework 
            <a href="https://bulma.io/">BULMA</a>.
          </p>
        </div>
    </footer>
    </body>
    
    
    
    
    
    
    
    
    </html>